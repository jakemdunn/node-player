var app=angular.module("musicApp",["ngCookies","ngPouch","ngRoute","btford.socket-io","angular-duration-format"]).config(["$routeProvider","$locationProvider","USER_ROLES",function(e,t,n){e.when("/",{templateUrl:"views/pages/home.html",controller:"HomeController",data:{authorizedRoles:[n.user,n.admin]}}).when("/login",{templateUrl:"views/pages/login.html",controller:"LoginController"}).when("/log",{templateUrl:"views/pages/log.html",controller:"LogController",data:{authorizedRoles:[n.user,n.admin]}}).otherwise({redirectTo:"/login"}),t.html5Mode(!0)}]).run(["$rootScope","$cookies","ngPouch","AuthService","AUTH_EVENTS",function(e,t,n,o,s){e.$on(s.loginSuccess,function(e,o){t.AuthSession=o.session,n.saveSettings({database:"http://localhost:5984/songs",stayConnected:!0}),n.init()}),o.init()}]);angular.module("ngPouch",["ngStorage"]).service("ngPouch",["$timeout","$localStorage",function(e,t){var n={db:new PouchDB("LocalDB"),remotedb:void 0,invokeApply:!0,settings:{database:void 0,username:void 0,password:void 0,stayConnected:void 0},status:{localChanges:0,changeEvents:{},replicationToEvents:{},replicationFromEvents:{}},session:{status:"offline",docsSent:0,docsReceived:0,currentRetryDelay:10,maxRetryDelay:6e5,retryDelayInc:1e3,lastConnectionAttempt:void 0,publishInProgress:!1},changes:void 0,replicationTo:void 0,replicationFrom:void 0,delayStatusPromise:void 0,retryPromise:void 0,publishPromise:void 0,init:function(){return this.loadSettings(),this.loadStatus(),this.trackChanges(),this.initRobustSync(1e3),[this.statusIcon(),this.statusTitle()]},incrementLocalChanges:function(){var e=this;"number"==typeof e.status.localChanges?e.status.localChanges++:e.status.localChanges=1,this.persistStatus()},resetLocalChanges:function(){this.status.localChanges=0,this.persistStatus()},storeChangeEvent:function(e,t){var n=this;"undefined"==typeof n.status.changeEvents&&(n.status.changeEvents={}),n.status.changeEvents[t]=e,n.persistStatus()},storeReplicationToEvent:function(e,t){var n=this;"undefined"==typeof n.status.replicationToEvents&&(n.status.replicationToEvents={}),n.status.replicationToEvents[t]=e,n.persistStatus()},storeReplicationFromEvent:function(e,t){var n=this;"undefined"==typeof n.status.replicationFromEvents&&(n.status.replicationFromEvents={}),n.status.replicationFromEvents[t]=e,n.persistStatus()},persistStatus:function(){t.pouchStatus=this.status},loadSettings:function(){"undefined"!=typeof t.pouchSettings&&(this.settings=t.pouchSettings)},loadStatus:function(){"undefined"!=typeof t.pouchStatus&&(this.status=t.pouchStatus)},publish:function(t){var n=this;n.session.publishInProgress=!1;var o=function(){n.session.publishInProgress===!1&&(n.session.publishInProgress=!0,t()["finally"](function(){e(function(){n.session.publishInProgress=!1},0,n.invokeApply)}))};n.db.info(function(e,t){"undefined"!=typeof n.publishPromise&&"undefined"!=typeof n.publishPromise.cancel&&n.publishPromise.cancel(),n.publishPromise=n.db.changes({since:t.update_seq-1,live:!0}).on("change",o)}),o()},getSettings:function(){return this.settings},saveSettings:function(e){this.settings=e,t.pouchSettings=this.getSettings(),this.initRobustSync(1e3)},localChanges:function(){return"undefined"==typeof this.status?"undefined":this.status.localChanges},statusIcon:function(){switch(this.session.status){case"connecting":return"ion-ios7-cloudy-night-outline";case"online":return"ion-ios7-cloud-outline";case"offline":return"ion-ios7-cloudy-night";case"idle":return"ion-ios7-cloud-outline";case"receiving":return"ion-ios7-cloud-download-outline";case"sending":return"ion-ios7-cloud-upload-outline";default:return"ion-alert-circled"}},statusTitle:function(){switch(this.session.status){case"online":return"Connected";case"connecting":return"Trying to connect";case"offline":return"Not connected";case"idle":return"Connected";case"receiving":return"Receiving Data";case"sending":return"Sending Data";default:return"Unknown Status"}},reset:function(){var e=this;PouchDB.destroy("LocalDB").then(function(){t.pouchStatus={},t.session={},e.disconnect(),e.init()})},initRobustSync:function(e){var t=this;t.session.currentRetryDelay=e,t.cancelProgressiveRetry(),t.settings.stayConnected===!0&&t.progressiveRetry()},attemptConnection:function(){var e=this;e.session.lastConnectionAttempt=new Date,e.flashSessionStatus("connecting"),e.connect()},maxOutProgressiveDelay:function(){this.initRobustSync(this.session.maxRetryDelay)},restartProgressiveDelay:function(){"connecting"!==this.session.status&&"offline"!==this.session.status&&this.initRobustSync(1e3)},cancelProgressiveRetry:function(){var t=this;"object"==typeof t.retryPromise&&e.cancel(t.retryPromise)},progressiveRetry:function(){var t=this;t.session.currentRetryDelay<t.session.maxRetryDelay&&(t.session.currentRetryDelay=t.session.currentRetryDelay+t.session.retryDelayInc),t.retryPromise=e(function(){t.progressiveRetry(),t.attemptConnection()},t.session.currentRetryDelay,!1)},flashSessionStatus:function(e){var t=this,n=t.session.status;t.setSessionStatus(e),t.delaySessionStatus(2e3,n)},setSessionStatus:function(t){var n=this;n.cancelSessionStatus(),e(function(){n.session.status=t},0,n.invokeApply)},delaySessionStatus:function(t,n){var o=this;o.cancelSessionStatus(),o.delayStatusPromise=e(function(){o.setSessionStatus(n)},t,o.invokeApply)},cancelSessionStatus:function(){var t=this;"object"==typeof t.delayStatusPromise&&e.cancel(t.delayStatusPromise)},isKeyInEncryptionList:function(e,t){var n=["design_doc"];return n.indexOf(e)?!1:"_"===e.substr(0,1)?!1:"function"==typeof t?!1:!0},recursiveObjectEncyptDecypt:function(e,t){var n=this;for(var o in e){var s=e[o];if(n.isKeyInEncryptionList(o,s))if("object"==typeof s)e[o]=n.recursiveObjectEncyptDecypt.call(n,s,t);else if("array"==typeof s)for(var i in s){{s[i]}s[i]=n.recursiveObjectEncyptDecypt.call(n,s[i],t)}else e[o]=t.call(this,s);"function"==typeof s&&delete e[o]}return e},trackChanges:function(){var e=this;"object"==typeof e.changes&&e.changes.cancel(),e.db.info().then(function(t){e.changes=e.db.changes({since:t.update_seq,live:!0}).on("change",function(t){e.handleChanges(t,"change")}).on("error",function(t){e.handleChanges(t,"error")}).on("complete",function(t){e.handleChanges(t,"complete")})})},handleChanges:function(t,n){var o=this;t.occurred_at=new Date,o.storeChangeEvent(t,n),"change"===n&&e(function(){o.incrementLocalChanges()},0,o.invokeApply)},handleReplicationFrom:function(e,t){var n=this;switch(e.occurred_at=new Date,n.storeReplicationFromEvent(e,t),t){case"uptodate":n.maxOutProgressiveDelay(),n.delaySessionStatus(800,"idle");break;case"error":n.restartProgressiveDelay(),n.delaySessionStatus(800,"offline");break;case"complete":break;case"change":n.maxOutProgressiveDelay(),e.docs_written>n.session.docsReceived&&(n.session.docsReceived=e.docs_written,n.setSessionStatus("receiving"))}},handleReplicationTo:function(e,t){var n=this;switch(t){case"uptodate":n.maxOutProgressiveDelay(),n.resetLocalChanges(),n.delaySessionStatus(800,"idle");break;case"error":n.restartProgressiveDelay(),n.delaySessionStatus(800,"offline");break;case"complete":break;case"change":n.maxOutProgressiveDelay(),e.docs_written>n.session.docsSent&&(n.session.docsSent=e.docs_written,n.setSessionStatus("sending"))}e.occurred_at=new Date,this.storeReplicationToEvent(e,t)},disconnect:function(){var e=this;"object"==typeof e.session.replicationTo&&(console.log("disconnect to"),e.session.replicationTo.cancel()),"object"==typeof e.session.replicationFrom&&(console.log("disconnect from"),e.session.replicationFrom.cancel())},createRemoteDb:function(){var e=this;"string"==typeof e.settings.database&&(e.remotedb=new PouchDB(this.settings.database),"string"==typeof e.settings.username&&"string"==typeof e.settings.password&&e.remotedb.login(this.settings.username,this.settings.password,function(){}))},logoff:function(){this.settings.stayConnected=!1,t.pouchSettings=this.getSettings(),this.cancelProgressiveRetry(),this.disconnect(),this.createRemoteDb(),this.delaySessionStatus(800,"offline")},connect:function(){var e=this;e.session.docsSent=0,e.session.docsReceived=0,e.disconnect(),e.createRemoteDb(),e.session.replicationTo=e.db.replicate.to(e.remotedb,{live:!0}).on("change",function(t){e.handleReplicationTo(t,"change")}).on("uptodate",function(t){e.handleReplicationTo(t,"uptodate")}).on("error",function(t){e.handleReplicationTo(t,"error")}).on("complete",function(t){e.handleReplicationTo(t,"complete")}),e.session.replicationFrom=e.db.replicate.from(e.remotedb,{live:!0}).on("change",function(t){e.handleReplicationFrom(t,"change")}).on("uptodate",function(t){e.handleReplicationFrom(t,"uptodate")}).on("error",function(t){e.handleReplicationFrom(t,"error")}).on("complete",function(t){e.handleReplicationFrom(t,"complete")})}};return n}]),function(e,t){"use strict";function n(){function e(e,n){return t.extend(Object.create(e),n)}function n(e,t){var n=t.caseInsensitiveMatch,o={originalPath:e,regexp:e},s=o.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,n,o){var i="?"===o?o:null,r="*"===o?o:null;return s.push({name:n,optional:!!i}),t=t||"",""+(i?"":t)+"(?:"+(i?t:"")+(r&&"(.+?)"||"([^/]+)")+(i||"")+")"+(i||"")}).replace(/([\/$\*])/g,"\\$1"),o.regexp=new RegExp("^"+e+"$",n?"i":""),o}var o={};this.when=function(e,s){var i=t.copy(s);if(t.isUndefined(i.reloadOnSearch)&&(i.reloadOnSearch=!0),t.isUndefined(i.caseInsensitiveMatch)&&(i.caseInsensitiveMatch=this.caseInsensitiveMatch),o[e]=t.extend(i,e&&n(e,i)),e){var r="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";o[r]=t.extend({redirectTo:e},n(r,i))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(e){return"string"==typeof e&&(e={redirectTo:e}),this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce",function(n,s,i,r,c,u,l){function d(e,t){var n=t.keys,o={};if(!t.regexp)return null;var s=t.regexp.exec(e);if(!s)return null;for(var i=1,r=s.length;r>i;++i){var a=n[i-1],c=s[i];a&&c&&(o[a.name]=c)}return o}function h(e){var o=S.current;v=p(),m=v&&o&&v.$$route===o.$$route&&t.equals(v.pathParams,o.pathParams)&&!v.reloadOnSearch&&!y,m||!o&&!v||n.$broadcast("$routeChangeStart",v,o).defaultPrevented&&e&&e.preventDefault()}function f(){var e=S.current,o=v;m?(e.params=o.params,t.copy(e.params,i),n.$broadcast("$routeUpdate",e)):(o||e)&&(y=!1,S.current=o,o&&o.redirectTo&&(t.isString(o.redirectTo)?s.path(g(o.redirectTo,o.params)).search(o.params).replace():s.url(o.redirectTo(o.pathParams,s.path(),s.search())).replace()),r.when(o).then(function(){if(o){var e,n,s=t.extend({},o.resolve);return t.forEach(s,function(e,n){s[n]=t.isString(e)?c.get(e):c.invoke(e,null,null,n)}),t.isDefined(e=o.template)?t.isFunction(e)&&(e=e(o.params)):t.isDefined(n=o.templateUrl)&&(t.isFunction(n)&&(n=n(o.params)),n=l.getTrustedResourceUrl(n),t.isDefined(n)&&(o.loadedTemplateUrl=n,e=u(n))),t.isDefined(e)&&(s.$template=e),r.all(s)}}).then(function(s){o==S.current&&(o&&(o.locals=s,t.copy(o.params,i)),n.$broadcast("$routeChangeSuccess",o,e))},function(t){o==S.current&&n.$broadcast("$routeChangeError",o,e,t)}))}function p(){var n,i;return t.forEach(o,function(o){!i&&(n=d(s.path(),o))&&(i=e(o,{params:t.extend({},s.search(),n),pathParams:n}),i.$$route=o)}),i||o[null]&&e(o[null],{params:{},pathParams:{}})}function g(e,n){var o=[];return t.forEach((e||"").split(":"),function(e,t){if(0===t)o.push(e);else{var s=e.match(/(\w+)(?:[?*])?(.*)/),i=s[1];o.push(n[i]),o.push(s[2]||""),delete n[i]}}),o.join("")}var v,m,y=!1,S={routes:o,reload:function(){y=!0,n.$evalAsync(function(){h(),f()})},updateParams:function(e){if(!this.current||!this.current.$$route)throw a("norout","Tried updating route when with no current route");e=t.extend({},this.current.params,e),s.path(g(this.current.$$route.originalPath,e)),s.search(e)}};return n.$on("$locationChangeStart",h),n.$on("$locationChangeSuccess",f),S}]}function o(){this.$get=function(){return{}}}function s(e,n,o){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(s,i,r,a,c){function u(){f&&(o.cancel(f),f=null),d&&(d.$destroy(),d=null),h&&(f=o.leave(h),f.then(function(){f=null}),h=null)}function l(){var r=e.current&&e.current.locals,a=r&&r.$template;if(t.isDefined(a)){var l=s.$new(),f=e.current,v=c(l,function(e){o.enter(e,null,h||i).then(function(){!t.isDefined(p)||p&&!s.$eval(p)||n()}),u()});h=v,d=f.scope=l,d.$emit("$viewContentLoaded"),d.$eval(g)}else u()}var d,h,f,p=r.autoscroll,g=r.onload||"";s.$on("$routeChangeSuccess",l),l()}}}function i(e,t,n){return{restrict:"ECA",priority:-400,link:function(o,s){var i=n.current,r=i.locals;s.html(r.$template);var a=e(s.contents());if(i.controller){r.$scope=o;var c=t(i.controller,r);i.controllerAs&&(o[i.controllerAs]=c),s.data("$ngControllerController",c),s.children().data("$ngControllerController",c)}a(o)}}}var r=t.module("ngRoute",["ng"]).provider("$route",n),a=t.$$minErr("ngRoute");r.provider("$routeParams",o),r.directive("ngView",s),r.directive("ngView",i),s.$inject=["$route","$anchorScroll","$animate"],i.$inject=["$compile","$controller","$route"]}(window,window.angular),function(){function e(e){return["$rootScope","$window","$log",function(t,n,o){for(var s,i,r,a=n[e]||(o.warn("This browser does not support Web Storage!"),{}),c={$default:function(e){for(var t in e)angular.isDefined(c[t])||(c[t]=e[t]);return c},$reset:function(e){for(var t in c)"$"===t[0]||delete c[t];return c.$default(e)}},u=0;u<a.length;u++)(r=a.key(u))&&"ngStorage-"===r.slice(0,10)&&(c[r.slice(10)]=angular.fromJson(a.getItem(r)));return s=angular.copy(c),t.$watch(function(){i||(i=setTimeout(function(){if(i=null,!angular.equals(c,s)){angular.forEach(c,function(e,t){angular.isDefined(e)&&"$"!==t[0]&&a.setItem("ngStorage-"+t,angular.toJson(e)),delete s[t]});for(var e in s)a.removeItem("ngStorage-"+e);s=angular.copy(c)}},100))}),"localStorage"===e&&n.addEventListener&&n.addEventListener("storage",function(e){"ngStorage-"===e.key.slice(0,10)&&(e.newValue?c[e.key.slice(10)]=angular.fromJson(e.newValue):delete c[e.key.slice(10)],s=angular.copy(c),t.$apply())}),c}]}angular.module("ngStorage",[]).factory("$localStorage",e("localStorage")).factory("$sessionStorage",e("sessionStorage"))}(),angular.module("btford.socket-io",[]).provider("socketFactory",function(){"use strict";var e="socket:";this.$get=["$rootScope","$timeout",function(t,n){var o=function(e,t){return t?function(){var o=arguments;n(function(){t.apply(e,o)},0)}:angular.noop};return function(n){n=n||{};var s=n.ioSocket||io.connect(),i=void 0===n.prefix?e:n.prefix,r=n.scope||t,a=function(e,t){s.on(e,t.__ng=o(s,t))},c=function(e,t){s.once(e,t.__ng=o(s,t))},u={on:a,addListener:a,once:c,emit:function(e,t,n){var i=arguments.length-1,n=arguments[i];return"function"==typeof n&&(n=o(s,n),arguments[i]=n),s.emit.apply(s,arguments)},removeListener:function(e,t){return t&&t.__ng&&(arguments[1]=t.__ng),s.removeListener.apply(s,arguments)},removeAllListeners:function(){return s.removeAllListeners.apply(s,arguments)},disconnect:function(e){return s.disconnect(e)},connect:function(){return s.connect()},forward:function(e,t){e instanceof Array==!1&&(e=[e]),t||(t=r),e.forEach(function(e){var n=i+e,r=o(s,function(){Array.prototype.unshift.call(arguments,n),t.$broadcast.apply(t,arguments)});t.$on("$destroy",function(){s.removeListener(e,r)}),s.on(e,r)})}};return u}}]});
//# sourceMappingURL=modules.js.map